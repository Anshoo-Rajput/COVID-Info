
<!DOCTYPE html>
<html>
<head>
	<title></title>
    
     <meta name="viewport" content="width=device-width, initial-scale=1.0">
     <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css">


<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<link rel="stylesheet" href="https://www.w3schools.com/lib/w3-theme-blue.css">

<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
</head>
<style>

  select{
    width: 100%;
    box-sizing: border-box;
  }


  /* body{
    background-color: #eef0dd;
  } */

  .table.table-striped thead th{
    background-color: rgba(0,0,0,0.05);
  }

  #mainNavbar .nav-link:hover{
	color: #32D328;
	padding-top: 12px;
}

.navbar .navbar-brand{
	color: white;
	font-size: 25px;
	padding-top: 12px;
}

.navbar-dark .navbar-nav .nav-link{
	padding-top: 15px;
  color : white;;
}



</style>
<body>
    


  <nav id="mainNavbar" class="navbar navbar-expand-lg  navbar-dark w3-theme-d4 fixed-top pt-0 mb-5" style="width: 1">
		<img src="/images/virus.png" style="width: 40px; height: 40px; margin-right: 10px; margin-left: 40px;">
		<a class="navbar-brand" href="#">Covid Info</a>
	  
		<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation" >
		  <span class="navbar-toggler-icon" ></span>
		</button>
	  
		<div class="collapse navbar-collapse" id="navbarSupportedContent">
		  <ul class="nav navbar-nav mr-auto">
			<li class="nav-item">
			  <a class="nav-link" href="/">Home </a>
			</li>
		   
			<li class="nav-item dropdown">
			  <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
				Statistics
			  </a>
			  <div class="dropdown-menu" aria-labelledby="navbarDropdown">
				<a class="dropdown-item" href="/world">World Stats</a>
				<a class="dropdown-item" href="/india">India Stats</a>
			</li>
			
			<li class="nav-item">
			  <a class="nav-link" href="/news">News</a>
			</li>
			<li class="nav-item">
			  <a class="nav-link" href="/info">Essentials</a>
			</li>
			<li class="nav-item">
			  <a class="nav-link" href="/groceries">Groceries</a>
			</li>
		  </ul>
		  <ul class="nav navbar-nav navbar-right" style=" margin-right: 70px;">
			  <li class="nav-item dropdown">
				  <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
					Helpful Links
				  </a>
				  <div class="dropdown-menu" aria-labelledby="navbarDropdown">
					<a class="dropdown-item" href="/helpline">Helpline Nos.</a>
					<a class="dropdown-item" href="/riskChecker">Covid Risk Ckecker</a>
				</li>
			</ul>     
		</div>
    </nav>



<% var s1=[]; state.forEach(function(place){   if(s1.includes(place) === false)    s1.push(place); }) %>
<% var s2=[]; city.forEach(function(place){  if(s2.includes(place) === false)  s2.push(place);  })  %>

<div class="container" style="margin-top: 100px;">
  <div class="row" style="margin: 0 auto;">
    <div class="col-6 col-lg-3" style="margin-top: 10px;">
      <select  class="custom-select" id="state">
        <option value=null>All States</option>
        <% s1.forEach(function(place){ %>
             <option value="<%=place%>"><%=place%></option>
        <% }) %>
     </select>
    </div>
    <div class="col-6 col-lg-3" style="margin-top: 10px;">
      <select class="custom-select" id="city">
        <option data-group='SHOW' value= null>-- All Cities --</option>
        <% s2.forEach(function(place){ %>
            <option  data-group="<%=place.state%>" value="<%=place.city%>">  <%=place.city%>  </option>
       <% }) %>
     </select>
    </div>
    <div class="col-6 col-lg-3" style="margin-top: 10px;">
      <select class="custom-select" id="category">
        <option data-group='SHOW' value= null>-- All Categories --</option>
          <% categories.forEach(function(place){ %>
              <option  data-group="<%=place.city%>" value="<%=place.category%>">  <%=place.category%>  </option>
         <% }) %>
      </select>
    </div>
    <div class="col-6 col-lg-2" style="margin-top: 10px;">
      <button class="btn btn-outline-primary" onclick="display()">Display</button>
    </div>
  </div>

  <div class="row" style="margin-top: 40px;">
    <div class="col-sm-12">
      
        <table class="table table-striped table-hover table-bordered" id="myTable" >
          <tr id="thead">
            <thead>
              <th>City</th>
              <th>Category</th>
              <th>Organisation</th>
              <th>Description</th>
              <th>Contact</th>
            </thead>
          </tr>
        </table>

    </div>
  </div>

</div>




 


















 

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<!-- Bootstrap tooltips -->
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.4/umd/popper.min.js"></script>
<!-- Bootstrap core JavaScript -->
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.4.1/js/bootstrap.min.js"></script>
<!-- MDB core JavaScript -->
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.15.0/js/mdb.min.js"></script>	


 <script>

$(function(){
    $('#state').on('change', function(){
        var val = $(this).val();
        var sub = $('#city');
        $('option', sub).filter(function(){
            if (
                 $(this).attr('data-group') === val 
              || $(this).attr('data-group') === 'SHOW'
            ) {
              if ($(this).parent('span').length) {
                $(this).unwrap();
              }
            } else {
              if (!$(this).parent('span').length) {
                $(this).wrap( "<span>" ).parent().hide();
              }
            }
        });
    });
    $('#state').trigger('change');


    $('#city').on('change', function(){
        var val = $(this).val();
        var sub = $('#category');
        $('option', sub).filter(function(){
            if (
                 $(this).attr('data-group') === val 
              || $(this).attr('data-group') === 'SHOW'
            ) {
              if ($(this).parent('span').length) {
                $(this).unwrap();
              }
            } else {
              if (!$(this).parent('span').length) {
                $(this).wrap( "<span>" ).parent().hide();
              }
            }
        });
    });
    $('#city').trigger('change');
});




// $(function(){
//     $('#city').on('change', function(){
//         var val = $(this).val();
//         var sub = $('#category');
//         $('option', sub).filter(function(){
//             if (
//                  $(this).attr('data-group') === val 
//               || $(this).attr('data-group') === 'SHOW'
//             ) {
//               if ($(this).parent('span').length) {
//                 $(this).unwrap();
//               }
//             } else {
//               if (!$(this).parent('span').length) {
//                 $(this).wrap( "<span>" ).parent().hide();
//               }
//             }
//         });
//     });
//     $('#city').trigger('change');
// });



  function display()
  {
          var e=document.getElementById("state");
          var state = e.options[e.selectedIndex].value;

          var e=document.getElementById("city");
          var city = e.options[e.selectedIndex].value;

          var e=document.getElementById("category");
          var category = e.options[e.selectedIndex].value;

          var details='<%-JSON.stringify(details)%>';
             details = details.replace(/\\n/g, "\\n")  
                .replace(/\\'/g, "\\'")
              .replace(/\\"/g, '\\"')
              .replace(/\\&/g, "\\&")
              .replace(/\\r/g, "\\r")
               .replace(/\\t/g, "\\t")
               .replace(/\\b/g, "\\b")
              .replace(/\\f/g, "\\f");
       // remove non-printable and other non-valid JSON chars
          details = details.replace(/[\u0000-\u0019]+/g,""); 
          details  = JSON.parse(details);

          var table= document.getElementById("myTable");
          $(".tbody").remove();


          if(state!=null && city!=null && category!=null)
          {
            details.resources.forEach(function(info){
              if(info.state == state && info.city == city && info.category == category)
              {
                var row = table.insertRow();
                row.className="tbody";
                var cell1 = row.insertCell(0).innerHTML=info.city;
                var cell2 = row.insertCell(1).innerHTML=info.category;
                var cell3 = row.insertCell(2).innerHTML=info.nameoftheorganisation;
                var cell4 = row.insertCell(3).innerHTML=info.descriptionandorserviceprovided;
                var cell5 = row.insertCell(4).innerHTML=info.phonenumber;
            
              }
            })
          }
  }















    // function cityList()
    // {
        
    //     var details='<%-JSON.stringify(details)%>';

    //     details = details.replace(/\\n/g, "\\n")  
    //            .replace(/\\'/g, "\\'")
    //            .replace(/\\"/g, '\\"')
    //            .replace(/\\&/g, "\\&")
    //            .replace(/\\r/g, "\\r")
    //            .replace(/\\t/g, "\\t")
    //            .replace(/\\b/g, "\\b")
    //            .replace(/\\f/g, "\\f");
    //     // remove non-printable and other non-valid JSON chars
    //     details = details.replace(/[\u0000-\u0019]+/g,""); 

    //     details  = JSON.parse(details);

    //     var e=document.getElementById("state");
    //     var value = e.options[e.selectedIndex].value;

    //     var city = document.getElementById("city");
        

    //         details.resources.forEach(function(info){
    //             if(info.state == value)
    //             {
    //                 var option = document.createElement("option");
    //                 option.text = option.value = info.city;
    //                 city.add(option);
    //             }
    //         });
            
    // }





 </script>





</body>
</html>